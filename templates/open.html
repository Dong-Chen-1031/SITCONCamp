{% extends "base.html" %}

{% block title %}æ­¡è¿ä¾†åˆ° AI é£Ÿè­œç”Ÿæˆå™¨{% endblock %}

{% block content %}
<div id="theme-root" class="min-h-screen bg-gradient-to-r from-pink-300 via-red-300 to-yellow-300 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8" style="position:relative;">
    <!-- å››æ®µå¼ iOS-style ä¸»é¡Œåˆ‡æ›é–‹é—œ -->
    <div id="theme-toggle-switch" style="position:fixed; top:24px; right:32px; z-index:10;">
      <div class="ios-switch-4" id="ios-switch-4">
        <div class="ios-switch-4-track">
          <span class="ios-switch-4-label" style="left:7px;">â˜€ï¸</span>
          <span class="ios-switch-4-label" style="left:33px;">ğŸŒ™</span>
          <span class="ios-switch-4-label" style="left:63px;">ğŸ˜‡</span>
          <span class="ios-switch-4-label" style="left:93px;">ğŸ˜ˆ</span>
        </div>
        <div class="ios-switch-4-thumb" id="ios-switch-4-thumb">
          <span class="ios-switch-4-icon" id="ios-switch-4-icon">â˜€ï¸</span>
        </div>
      </div>
    </div>
    <!-- å¤©å ‚èƒŒæ™¯åœ– -->
    <div id="heaven-bg" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; z-index:-10; pointer-events:none;">
        <img src="{{ url_for('static', filename='img/paradise.png') }}" style="position:absolute; left:0; top:0; width:100vw; height:100vh; object-fit:cover; opacity:0.18;" alt="heaven background" />
    </div>
    <!-- åœ°ç„èƒŒæ™¯åœ–ï¼ˆåƒ…æ·±è‰²é®ç½©ï¼Œç„¡æ·ºè‰²é®ç½©ï¼‰ -->
    <div id="hell-bg" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; z-index:-11; pointer-events:none;">
        <img src="{{ url_for('static', filename='img/hell.png') }}" style="position:absolute; left:0; top:0; width:100vw; height:100vh; object-fit:cover; opacity:1;" alt="hell background" />
        <div style="position:absolute; left:0; top:0; width:100vw; height:100vh; background:rgba(30,20,40,0.55);"></div>
    </div>
    <!-- é¦¬éˆ´è–¯ bouncing imagesï¼Œæ”¾åœ¨æœ€åº•å±¤ -->
    <div id="potato-layer" style="position:fixed; left:0; top:0; width:100vw; height:100vh; z-index:0; pointer-events:none;">
        <img src="{{ url_for('static', filename='img/putato.png') }}" class="bouncingImage" />
        <img src="{{ url_for('static', filename='img/putato.png') }}" class="bouncingImage" />
        <img src="{{ url_for('static', filename='img/putato.png') }}" class="bouncingImage" />
        <img src="{{ url_for('static', filename='img/putato.png') }}" class="bouncingImage" />
    </div>
    <div id="main-card" class="max-w-2xl w-full space-y-8 text-center bg-white dark:bg-gray-800 p-10 rounded-xl shadow-lg" style="position:relative; z-index:1; transition:background 0.3s, color 0.3s; min-width:190px; height:calc(100% - 2rem + 30px); max-width:calc(672px - 110px);">
        <div>
            <h2 class="mt-6 text-center text-4xl font-extrabold text-pink-600 dark:text-pink-300" id="main-title">
                æ­¡è¿ä¾†åˆ° AI é£Ÿè­œç”Ÿæˆå™¨
            </h2>
            <p class="mt-2 text-center text-lg text-gray-700 dark:text-gray-300" id="main-desc">
                ğŸ¥˜ æº–å‚™å¥½ç”¨ç©æœ¨å‰µé€ ä½ çš„ç¨ç‰¹é£Ÿè­œäº†å—ï¼Ÿ
            </p>
        </div>
        <div>
            <a href="{{ url_for('index') }}"
               class="group relative w-full flex justify-center py-3 px-5 border border-transparent text-lg font-bold rounded-full text-white bg-gradient-to-r from-orange-400 to-red-500 hover:from-orange-500 hover:to-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-400 transition-all duration-300 dark:bg-gradient-to-r dark:from-gray-700 dark:to-gray-900 dark:text-pink-200"
               id="main-btn">
                <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                    <span class="material-icons text-white dark:text-pink-200">restaurant</span>
                </span>
                é€²å…¥çƒ¹é£ªå»šæˆ¿
            </a>
        </div>
    </div>
    <style>
    /* æ·±è‰²æ¨¡å¼èƒŒæ™¯æ¼¸å±¤ */
    #theme-root.dark {
        background: linear-gradient(90deg, #23272f 0%, #2d2f3a 50%, #23272f 100%) !important;
    }
    /* å¤©å ‚/åœ°ç„æ¨¡å¼ä¸‹ä¸»èƒŒæ™¯é€æ˜ */
    #theme-root.heaven-bg, #theme-root.hell-bg {
        background: transparent !important;
    }
    /* å››æ®µå¼ iOS-style switch */
    .ios-switch-4 {
      width: 120px;
      height: 36px;
      position: relative;
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }
    .ios-switch-4-track {
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, #ffe0e0 0%, #fff7c2 100%);
      border-radius: 999px;
      box-shadow: 0 2px 8px #0001;
      transition: background 0.3s;
      position: relative;
    }
    #theme-root.dark .ios-switch-4-track {
      background: linear-gradient(90deg, #23272f 0%, #2d2f3a 100%);
    }
    .ios-switch-4-label {
      position: absolute;
      top: 7px;
      width: 24px;
      text-align: center;
      font-size: 1.1rem;
      opacity: 0.7;
      pointer-events: none;
      user-select: none;
      z-index: 1;
    }
    .ios-switch-4-thumb {
      position: absolute;
      top: 4px;
      left: 4px;
      width: 28px;
      height: 28px;
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 2px 8px #0002;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: left 0.25s cubic-bezier(.4,2,.6,1), background 0.3s;
      will-change: left;
      font-size: 1.2rem;
      z-index: 2;
    }
    #theme-root.dark .ios-switch-4-thumb {
      background: #23272f;
      color: #ffe066;
    }
    .ios-switch-4-icon {
      pointer-events: none;
      font-size: 1.2rem;
      transition: color 0.3s;
    }
    </style>
    <script>
    // å››æ®µå¼ iOS-style ä¸»é¡Œåˆ‡æ›
    const themeRoot = document.getElementById('theme-root');
    const heavenBg = document.getElementById('heaven-bg');
    const hellBg = document.getElementById('hell-bg');
    const iosSwitch4 = document.getElementById('ios-switch-4');
    const iosThumb4 = document.getElementById('ios-switch-4-thumb');
    const iosIcon4 = document.getElementById('ios-switch-4-icon');
    // 0: light, 1: dark, 2: heaven, 3: hell
    let themeMode = 0;
    let dragging = false, startX = 0, thumbStart = 0;
    // å››æ®µ thumb ç²¾ç¢ºä½ç½®ï¼ˆæ ¹æ“š switch å¯¬åº¦ 120px, thumb 28px, track 4px paddingï¼‰
    const positions = [4, 34, 64, 94];
    const icons = ['â˜€ï¸', 'ğŸŒ™', 'ğŸ˜‡', 'ğŸ˜ˆ'];

    function setThemeMode(mode, animate = true) {
      themeMode = mode;
      iosThumb4.style.left = positions[mode] + 'px';
      iosIcon4.textContent = icons[mode];
      // å…ˆç§»é™¤é€æ˜èƒŒæ™¯ class
      themeRoot.classList.remove('heaven-bg', 'hell-bg');
      if (mode === 0) { // light
        themeRoot.classList.remove('dark');
        document.body.classList.remove('dark');
        heavenBg.style.display = 'none';
        hellBg.style.display = 'none';
      } else if (mode === 1) { // dark
        themeRoot.classList.add('dark');
        document.body.classList.add('dark');
        heavenBg.style.display = 'none';
        hellBg.style.display = 'none';
      } else if (mode === 2) { // heaven
        themeRoot.classList.remove('dark');
        document.body.classList.remove('dark');
        heavenBg.style.display = '';
        hellBg.style.display = 'none';
        themeRoot.classList.add('heaven-bg');
      } else if (mode === 3) { // hell
        themeRoot.classList.add('dark');
        document.body.classList.add('dark');
        heavenBg.style.display = 'none';
        hellBg.style.display = '';
        themeRoot.classList.add('hell-bg');
      }
      if (!animate) {
        iosThumb4.style.transition = 'none';
        setTimeout(()=>{ iosThumb4.style.transition = ''; }, 10);
      }
    }

    // åˆå§‹åŒ–ï¼ˆæ ¹æ“šç³»çµ±é è¨­ï¼‰
    setThemeMode(window.matchMedia('(prefers-color-scheme: dark)').matches ? 1 : 0, false);

    // é»æ“Šåˆ‡æ›
    iosSwitch4.addEventListener('click', function(e) {
      if (dragging) return;
      // æ ¹æ“šé»æ“Šä½ç½®æ±ºå®šæ¨¡å¼
      const rect = iosSwitch4.getBoundingClientRect();
      const x = e.clientX - rect.left;
      let idx = 0;
      if (x > rect.width * 0.85) idx = 3;
      else if (x > rect.width * 0.6) idx = 2;
      else if (x > rect.width * 0.35) idx = 1;
      setThemeMode(idx);
    });

    // æ‹–æ›³åˆ‡æ›
    iosThumb4.addEventListener('mousedown', function(e) {
      dragging = true;
      startX = e.clientX;
      thumbStart = parseInt(iosThumb4.style.left) || positions[themeMode];
      iosThumb4.style.transition = 'none';
      document.body.style.userSelect = 'none';
    });
    document.addEventListener('mousemove', function(e) {
      if (!dragging) return;
      let dx = e.clientX - startX;
      let newLeft = Math.min(positions[3], Math.max(positions[0], thumbStart + dx));
      iosThumb4.style.left = newLeft + 'px';
      // å‹•æ…‹åˆ‡æ› icon
      let idx = 0;
      if (newLeft > (positions[2] + positions[3]) / 2) idx = 3;
      else if (newLeft > (positions[1] + positions[2]) / 2) idx = 2;
      else if (newLeft > (positions[0] + positions[1]) / 2) idx = 1;
      iosIcon4.textContent = icons[idx];
    });
    document.addEventListener('mouseup', function(e) {
      if (!dragging) return;
      dragging = false;
      document.body.style.userSelect = '';
      let left = parseInt(iosThumb4.style.left) || positions[themeMode];
      let idx = 0;
      if (left > (positions[2] + positions[3]) / 2) idx = 3;
      else if (left > (positions[1] + positions[2]) / 2) idx = 2;
      else if (left > (positions[0] + positions[1]) / 2) idx = 1;
      setThemeMode(idx);
      iosThumb4.style.transition = '';
    });

    // ç›£è½ç³»çµ±ä¸»é¡Œè®ŠåŒ–ï¼ˆåªåœ¨ light/dark æ™‚è‡ªå‹•åˆ‡æ›ï¼‰
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      if (themeMode === 0 || themeMode === 1) setThemeMode(e.matches ? 1 : 0);
    });
    </script>
    <script src="{{ url_for('static', filename='js/open.js') }}"></script>
    <script src="{{ url_for('static', filename='js/recipe-generator.js') }}"></script>
</div>
{% endblock %}